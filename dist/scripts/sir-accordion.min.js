!function(){"use strict";angular.module("sir-accordion",[]).directive("sirAccordion",["$compile","$timeout","$parse",function(o,n,e){return{restrict:"A",scope:!0,controller:["$scope",function(o){}],link:function(i,a,t){var c=[],r=[],d="0";i.accordionConfig=e(t.config)(i),i.accordionConfig||(i.accordionConfig={}),i.accordionConfig.id=a.attr("id")||i.accordionConfig.id||"",i.accordionConfig.animDur=0===i.accordionConfig.animDur?0:i.accordionConfig.animDur||300,i.accordionConfig.headerClass=i.accordionConfig.headerClass||"",i.accordionConfig.beforeHeader=i.accordionConfig.beforeHeader||"",i.accordionConfig.afterHeader=i.accordionConfig.afterHeader||"",i.accordionConfig.topContentClass=i.accordionConfig.topContentClass||"",i.accordionConfig.beforeTopContent=i.accordionConfig.beforeTopContent||"",i.accordionConfig.afterTopContent=i.accordionConfig.afterTopContent||"",i.accordionConfig.bottomContentClass=i.accordionConfig.bottomContentClass||"",i.accordionConfig.beforeBottomContent=i.accordionConfig.beforeBottomContent||"",i.accordionConfig.afterBottomContent=i.accordionConfig.afterBottomContent||"",i.accordionConfig.watchInternalChanges=i.accordionConfig.watchInternalChanges||!0,i.$watch(t.collection,function(n){var f=e(t.collection)(i);if(f&&angular.isArray(f)){i.accordionConfig.id&&(null==document.getElementById(i.accordionConfig.id)?a.attr("id",i.accordionConfig.id):i.accordionConfig.debug&&console.log("Id already exists"));var C;c=[],r=[],d="0",C=s(f,0,0,0),a.html(""),g&&(g.$destroy(),g=null);var g=i.$new(),u=o(C)(g);a.append(u),l(),i.$emit("sacDoneLoading"),i.accordionConfig.expandFirst&&x("1")}else a.html("No collection found")},i.accordionConfig.watchInternalChanges);var l=function(){for(var o=null,n=null,e=null,t=r.length-1;t>=0;t--)e=(n=(o=a[0].querySelector(".sac"+r[t])).firstElementChild?o.firstElementChild:o.firstChild).nextSibling,r[t]={id:o.className,obj:e},c[t]={id:o.className,obj:n},o.firstElementChild&&(c[t].obj.style.transition="all "+i.accordionConfig.animDur+"ms")},s=function(o,n,e,a){var t,c,d=null;if(e==o.length)return"";var l=c=a?String(n)+"-"+String(e+1):String(e+1);t=i.accordionConfig.beforeHeader+o[e].title+i.accordionConfig.afterHeader,r.push(c);var C="";return angular.isArray(o[e].subCollection)&&o[e].subCollection.length||(C="sir-accordion-leaf"),d='<div class="sac'+c+'" ><div class="'+("sir-accordion-header "+i.accordionConfig.headerClass).trim()+'" ng-click="expandCollapseProgrammatically(\''+c+"')\">"+t+'</div><div class="sir-accordion-content '+C+'"><div><div class="'+i.accordionConfig.topContentClass+'">'+f(i.accordionConfig.beforeTopContent,o[e].topContent,i.accordionConfig.afterTopContent,"sac-top-"+l)+"</div>",0==e&&(d=0==a?'<div class="sir-accordion-wrapper">'+d:'<div class="sir-accordion-group">'+d),(d=angular.isArray(o[e].subCollection)&&o[e].subCollection.length?(d+=s(o[e].subCollection,c,0,a+1))+'</div><div class="'+i.accordionConfig.bottomContentClass+'">'+f(i.accordionConfig.beforeBottomContent,o[e].bottomContent,i.accordionConfig.afterBottomContent,"sac-bottom-"+l)+"</div></div></div></div>":d+'<div class="'+i.accordionConfig.bottomContentClass+'">'+f(i.accordionConfig.beforeBottomContent,o[e].bottomContent,i.accordionConfig.afterBottomContent,"sac-bottom-"+l)+"</div></div></div></div>")+s(o,n,e+1,a)},f=function(o,n,e,a){return n||(n=""),a?o+'<div id="'+i.accordionConfig.id+a+'">'+n+"</div>"+e:o+"<div>"+n+"</div>"+e},C=function(o,n){if(i.accordionConfig.debug&&console.log("Chain collapsing"),!(g(o)<=n))do{for(var e=r.length-1;e>=0;e--)i.accordionConfig.autoCollapse&&r[e].id=="sac"+o?(p(r[e],"expanded"),p(c[e],"active-header")):u(r[e].id)==u(o)&&r[e].obj.className.indexOf("expanded")>-1&&(p(r[e],"expanded"),p(c[e],"active-header"));o=u(o)}while(g(o)!=n)},g=function(o){return"0"==o?0:o.split("-").length},u=function(o){if(-1==o.indexOf("-"))return"0";var n="";do{n=o.substr(o.length-1),o=o.slice(0,-1)}while("-"!=n);return o=o.replace("sac","")},p=function(o,n){var e=null;return o.obj.className.indexOf(n)>-1?(o.obj.className=o.obj.className.replace(n,""),i.accordionConfig.debug&&console.log("removing class "+o.id),"expanded"==n&&(e=o.obj.firstElementChild?o.obj.firstElementChild:o.obj.firstChild,m(e,"finish"),m(e,"slideUp",{display:null,duration:i.accordionConfig.animDur,complete:function(){e.style.height="0px";var n=o.id.replace("sac","");g(d)===g(n)-1&&i.$emit("sacCollapseEnd",n)}})),!0):(o.obj.className=h(o.obj.className)+" "+n,i.accordionConfig.debug&&console.log("adding class "+o.id),"expanded"==n&&(e=o.obj.firstElementChild?o.obj.firstElementChild:o.obj.firstChild,m(e,"finish"),m(e,"slideDown",{delay:0,duration:i.accordionConfig.animDur,progress:function(){o.obj.style.height="auto"},begin:function(){o.obj.style.height="0px",e.style.height="auto"},complete:function(){o.id.replace("sac","")===d&&i.$emit("sacExpandEnd",d)}})),!0)},m=function(o,n,e){return"undefined"==typeof Velocity?void(e?$(o).velocity(n,e):$(o).velocity(n)):void(e?Velocity(o,n,e):Velocity(o,n))},v=function(o,n){do{if(u(n)==o)return!0;n=u(n)}while(g(n)>g(o));return!1},h=function(o){for(var n=/\s/,e=(o=o.replace(/^\s\s*/,"")).length;n.test(o.charAt(--e)););return o.slice(0,e+1)},b=function(o){for(var n=r.length-1;n>=0;n--)if(r[n].id=="sac"+o||r[n].id==o)return n;return-1},x=function(o){if("0"==o)return E(),void(d="0");if(o!=d){if(v(o,d))return C(d,g(o)),void(d=o);var n=o.split("-"),e=d.split("-"),a="",t=0,l=0,s=0;if(i.accordionConfig.autoCollapse&&"0"!=d){for(var f=0;f<n.length||f<e.length;f++)n[f]!=e[f]||s?s++:l++;if(s>1&&l<g(o))for(var m=e.length-l,h=d;m>0;)p(r[b(h)],"expanded"),p(c[b(h)],"active-header"),h=u(h),m--;else C(d,g(o)-1)}for(f=0;f<n.length;f++){for(var x=0;x<=f;x++)a=x?a+"-"+n[x]:n[x];r[b(a)]?-1==r[b(a)].obj.className.indexOf("expanded")?(j(r[b(a)],c[b(a)],t),f===n.length-1&&i.$emit("sacExpandStart",a),d=a):t--:i.accordionConfig.debug&&console.log("%c Coordinate does not match an element","background: #0044CE; color: #fff"),a=""}}};i.expandCollapseProgrammatically=function(o){-1!=r[b(o)].obj.className.indexOf("expanded")?y(o):x(o)};var y=function(o){-1!=r[b(o)].obj.className.indexOf("expanded")&&(!function(o,n){for(var e=o.length-1;e>=0;e--)v(n,o[e].id)&&o[e].obj.className.indexOf("expanded")>-1&&(p(o[e],"expanded"),p(c[e],"active-header"))}(r,o),p(r[b(o)],"expanded"),p(c[b(o)],"active-header"),i.$emit("sacCollapseStart",d),d=u(o))},j=function(o,e,a){n(function(){p(o,"expanded"),p(e,"active-header")},i.accordionConfig.animDur*(g(o.id)-1+a))},E=function(){d="0";for(var o=r.length-1;o>=0;o--)r[o].obj.className.indexOf("expanded")>-1&&(p(r[o],"expanded"),p(c[o],"active-header"))};i.$on("sacCollapseAll",function(o){E(),o.defaultPrevented=!0}),i.$on("sacExpandAll",function(o,n){if(!i.accordionConfig.autoCollapse)for(var e=0;e<=r.length-1;e++)-1==r[e].obj.className.indexOf("expanded")&&j(r[e],c[e],0);o.defaultPrevented=!0}),i.$on("sacExpandContentById",function(o,n){x(n),o.defaultPrevented=!0}),i.$on("sacCollapseContentById",function(o,n){y(n),o.defaultPrevented=!0})}}}])}();